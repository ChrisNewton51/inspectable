{"version":3,"names":["useIAP","connected","products","promotedProductsIOS","subscriptions","purchaseHistories","availablePurchases","currentPurchase","currentPurchaseError","initConnectionError","setProducts","setSubscriptions","setAvailablePurchases","setPurchaseHistories","setCurrentPurchase","setCurrentPurchaseError","useIAPContext","getProducts","useCallback","skus","iapGetProducts","getSubscriptions","iapGetSubscriptions","getAvailablePurchases","iapGetAvailablePurchases","getPurchaseHistories","getPurchaseHistory","finishTransaction","purchase","isConsumable","developerPayloadAndroid","iapFinishTransaction","err","productId","undefined","requestPurchase","iapRequestPurchase","requestSubscription","iapRequestSubscription"],"sources":["useIAP.ts"],"sourcesContent":["import {useCallback} from 'react';\n\nimport {\n  finishTransaction as iapFinishTransaction,\n  getAvailablePurchases as iapGetAvailablePurchases,\n  getProducts as iapGetProducts,\n  getPurchaseHistory,\n  getSubscriptions as iapGetSubscriptions,\n  requestPurchase as iapRequestPurchase,\n  requestSubscription as iapRequestSubscription,\n} from '../iap';\nimport type {Product, Purchase, PurchaseError, Subscription} from '../types';\n\nimport {useIAPContext} from './withIAPContext';\n\ntype IAP_STATUS = {\n  connected: boolean;\n  products: Product[];\n  promotedProductsIOS: Product[];\n  subscriptions: Subscription[];\n  purchaseHistories: Purchase[];\n  availablePurchases: Purchase[];\n  currentPurchase?: Purchase;\n  currentPurchaseError?: PurchaseError;\n  initConnectionError?: Error;\n  finishTransaction: (\n    purchase: Purchase,\n    isConsumable?: boolean,\n    developerPayloadAndroid?: string,\n  ) => Promise<string | void>;\n  getAvailablePurchases: () => Promise<void>;\n  getPurchaseHistories: () => Promise<void>;\n  getProducts: (skus: string[]) => Promise<void>;\n  getSubscriptions: (skus: string[]) => Promise<void>;\n  requestPurchase: typeof iapRequestPurchase;\n  requestSubscription: typeof iapRequestSubscription;\n};\n\nexport function useIAP(): IAP_STATUS {\n  const {\n    connected,\n    products,\n    promotedProductsIOS,\n    subscriptions,\n    purchaseHistories,\n    availablePurchases,\n    currentPurchase,\n    currentPurchaseError,\n    initConnectionError,\n    setProducts,\n    setSubscriptions,\n    setAvailablePurchases,\n    setPurchaseHistories,\n    setCurrentPurchase,\n    setCurrentPurchaseError,\n  } = useIAPContext();\n\n  const getProducts = useCallback(\n    async (skus: string[]): Promise<void> => {\n      setProducts(await iapGetProducts(skus));\n    },\n    [setProducts],\n  );\n\n  const getSubscriptions = useCallback(\n    async (skus: string[]): Promise<void> => {\n      setSubscriptions(await iapGetSubscriptions(skus));\n    },\n    [setSubscriptions],\n  );\n\n  const getAvailablePurchases = useCallback(async (): Promise<void> => {\n    setAvailablePurchases(await iapGetAvailablePurchases());\n  }, [setAvailablePurchases]);\n\n  const getPurchaseHistories = useCallback(async (): Promise<void> => {\n    setPurchaseHistories(await getPurchaseHistory());\n  }, [setPurchaseHistories]);\n\n  const finishTransaction = useCallback(\n    async (\n      purchase: Purchase,\n      isConsumable?: boolean,\n      developerPayloadAndroid?: string,\n    ): Promise<string | void> => {\n      try {\n        return await iapFinishTransaction(\n          purchase,\n          isConsumable,\n          developerPayloadAndroid,\n        );\n      } catch (err) {\n        throw err;\n      } finally {\n        if (purchase.productId === currentPurchase?.productId) {\n          setCurrentPurchase(undefined);\n        }\n\n        if (purchase.productId === currentPurchaseError?.productId) {\n          setCurrentPurchaseError(undefined);\n        }\n      }\n    },\n    [\n      currentPurchase?.productId,\n      currentPurchaseError?.productId,\n      setCurrentPurchase,\n      setCurrentPurchaseError,\n    ],\n  );\n\n  return {\n    connected,\n    products,\n    promotedProductsIOS,\n    subscriptions,\n    purchaseHistories,\n    availablePurchases,\n    currentPurchase,\n    currentPurchaseError,\n    initConnectionError,\n    finishTransaction,\n    getProducts,\n    getSubscriptions,\n    getAvailablePurchases,\n    getPurchaseHistories,\n    requestPurchase: iapRequestPurchase,\n    requestSubscription: iapRequestSubscription,\n  };\n}\n"],"mappings":";;;;;;;AAAA;;AAEA;;AAWA;;AAyBO,SAASA,MAAT,GAA8B;EACnC,MAAM;IACJC,SADI;IAEJC,QAFI;IAGJC,mBAHI;IAIJC,aAJI;IAKJC,iBALI;IAMJC,kBANI;IAOJC,eAPI;IAQJC,oBARI;IASJC,mBATI;IAUJC,WAVI;IAWJC,gBAXI;IAYJC,qBAZI;IAaJC,oBAbI;IAcJC,kBAdI;IAeJC;EAfI,IAgBF,IAAAC,6BAAA,GAhBJ;EAkBA,MAAMC,WAAW,GAAG,IAAAC,kBAAA,EAClB,MAAOC,IAAP,IAAyC;IACvCT,WAAW,CAAC,MAAM,IAAAU,gBAAA,EAAeD,IAAf,CAAP,CAAX;EACD,CAHiB,EAIlB,CAACT,WAAD,CAJkB,CAApB;EAOA,MAAMW,gBAAgB,GAAG,IAAAH,kBAAA,EACvB,MAAOC,IAAP,IAAyC;IACvCR,gBAAgB,CAAC,MAAM,IAAAW,qBAAA,EAAoBH,IAApB,CAAP,CAAhB;EACD,CAHsB,EAIvB,CAACR,gBAAD,CAJuB,CAAzB;EAOA,MAAMY,qBAAqB,GAAG,IAAAL,kBAAA,EAAY,YAA2B;IACnEN,qBAAqB,CAAC,MAAM,IAAAY,0BAAA,GAAP,CAArB;EACD,CAF6B,EAE3B,CAACZ,qBAAD,CAF2B,CAA9B;EAIA,MAAMa,oBAAoB,GAAG,IAAAP,kBAAA,EAAY,YAA2B;IAClEL,oBAAoB,CAAC,MAAM,IAAAa,uBAAA,GAAP,CAApB;EACD,CAF4B,EAE1B,CAACb,oBAAD,CAF0B,CAA7B;EAIA,MAAMc,iBAAiB,GAAG,IAAAT,kBAAA,EACxB,OACEU,QADF,EAEEC,YAFF,EAGEC,uBAHF,KAI6B;IAC3B,IAAI;MACF,OAAO,MAAM,IAAAC,sBAAA,EACXH,QADW,EAEXC,YAFW,EAGXC,uBAHW,CAAb;IAKD,CAND,CAME,OAAOE,GAAP,EAAY;MACZ,MAAMA,GAAN;IACD,CARD,SAQU;MACR,IAAIJ,QAAQ,CAACK,SAAT,MAAuB1B,eAAvB,aAAuBA,eAAvB,uBAAuBA,eAAe,CAAE0B,SAAxC,CAAJ,EAAuD;QACrDnB,kBAAkB,CAACoB,SAAD,CAAlB;MACD;;MAED,IAAIN,QAAQ,CAACK,SAAT,MAAuBzB,oBAAvB,aAAuBA,oBAAvB,uBAAuBA,oBAAoB,CAAEyB,SAA7C,CAAJ,EAA4D;QAC1DlB,uBAAuB,CAACmB,SAAD,CAAvB;MACD;IACF;EACF,CAvBuB,EAwBxB,CACE3B,eADF,aACEA,eADF,uBACEA,eAAe,CAAE0B,SADnB,EAEEzB,oBAFF,aAEEA,oBAFF,uBAEEA,oBAAoB,CAAEyB,SAFxB,EAGEnB,kBAHF,EAIEC,uBAJF,CAxBwB,CAA1B;EAgCA,OAAO;IACLd,SADK;IAELC,QAFK;IAGLC,mBAHK;IAILC,aAJK;IAKLC,iBALK;IAMLC,kBANK;IAOLC,eAPK;IAQLC,oBARK;IASLC,mBATK;IAULkB,iBAVK;IAWLV,WAXK;IAYLI,gBAZK;IAaLE,qBAbK;IAcLE,oBAdK;IAeLU,eAAe,EAAEC,oBAfZ;IAgBLC,mBAAmB,EAAEC;EAhBhB,CAAP;AAkBD"}