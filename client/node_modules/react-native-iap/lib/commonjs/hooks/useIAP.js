"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useIAP = useIAP;

var _react = require("react");

var _iap = require("../iap");

var _withIAPContext = require("./withIAPContext");

function useIAP() {
  const {
    connected,
    products,
    promotedProductsIOS,
    subscriptions,
    purchaseHistories,
    availablePurchases,
    currentPurchase,
    currentPurchaseError,
    initConnectionError,
    setProducts,
    setSubscriptions,
    setAvailablePurchases,
    setPurchaseHistories,
    setCurrentPurchase,
    setCurrentPurchaseError
  } = (0, _withIAPContext.useIAPContext)();
  const getProducts = (0, _react.useCallback)(async skus => {
    setProducts(await (0, _iap.getProducts)(skus));
  }, [setProducts]);
  const getSubscriptions = (0, _react.useCallback)(async skus => {
    setSubscriptions(await (0, _iap.getSubscriptions)(skus));
  }, [setSubscriptions]);
  const getAvailablePurchases = (0, _react.useCallback)(async () => {
    setAvailablePurchases(await (0, _iap.getAvailablePurchases)());
  }, [setAvailablePurchases]);
  const getPurchaseHistories = (0, _react.useCallback)(async () => {
    setPurchaseHistories(await (0, _iap.getPurchaseHistory)());
  }, [setPurchaseHistories]);
  const finishTransaction = (0, _react.useCallback)(async (purchase, isConsumable, developerPayloadAndroid) => {
    try {
      return await (0, _iap.finishTransaction)(purchase, isConsumable, developerPayloadAndroid);
    } catch (err) {
      throw err;
    } finally {
      if (purchase.productId === (currentPurchase === null || currentPurchase === void 0 ? void 0 : currentPurchase.productId)) {
        setCurrentPurchase(undefined);
      }

      if (purchase.productId === (currentPurchaseError === null || currentPurchaseError === void 0 ? void 0 : currentPurchaseError.productId)) {
        setCurrentPurchaseError(undefined);
      }
    }
  }, [currentPurchase === null || currentPurchase === void 0 ? void 0 : currentPurchase.productId, currentPurchaseError === null || currentPurchaseError === void 0 ? void 0 : currentPurchaseError.productId, setCurrentPurchase, setCurrentPurchaseError]);
  return {
    connected,
    products,
    promotedProductsIOS,
    subscriptions,
    purchaseHistories,
    availablePurchases,
    currentPurchase,
    currentPurchaseError,
    initConnectionError,
    finishTransaction,
    getProducts,
    getSubscriptions,
    getAvailablePurchases,
    getPurchaseHistories,
    requestPurchase: _iap.requestPurchase,
    requestSubscription: _iap.requestSubscription
  };
}
//# sourceMappingURL=useIAP.js.map